main
    // Primera clase: Point
    class Point
        x: float;
        y: float;
        
        func init(self: Point, x: float, y: float) -> void
            self.x = x;
            self.y = y;
        end
        
        func distance(self: Point, other: Point) -> float
            dx = self.x - other.x;
            dy = self.y - other.y;
            return sqrt(dx * dx + dy * dy);
        end
    end
    
    // Segunda clase: Vector3
    class Vector3
        x: float;
        y: float;
        z: float;
        
        func init(self: Vector3, x: float, y: float, z: float) -> void
            self.x = x;
            self.y = y;
            self.z = z;
        end
        
        func magnitude(self: Vector3) -> float
            return sqrt(self.x * self.x + self.y * self.y + self.z * self.z);
        end
        
        func add(self: Vector3, other: Vector3) -> Vector3
            result = new_Vector3();
            Vector3_init(result, self.x + other.x, self.y + other.y, self.z + other.z);
            return result;
        end
    end
    
    // Tercera clase: Shape y Circle (herencia)
    class Shape
        x: float;
        y: float;
        
        func init(self: Shape, x: float, y: float) -> void
            self.x = x;
            self.y = y;
        end
        
        func area(self: Shape) -> float
            return 0.0;
        end
    end
    
    class Circle : Shape
        radius: float;
        
        func init(self: Circle, x: float, y: float, r: float) -> void
            Shape_init(self, x, y);  // Llamada al constructor padre
            self.radius = r;
        end
        
        func area(self: Circle) -> float
            return 3.14159 * self.radius * self.radius;
        end
        
        func scale(self: Circle, factor: float) -> void
            self.radius = self.radius * factor;
        end
    end
    
    // Test del sistema de tipos con inferencia
    print("=== Testing Type System ===");
    
    // Variables con tipos explícitos
    explicit_int: int = 42;
    explicit_float: float = 3.14;
    
    // Variables con tipos inferidos
    inferred_int = 100;
    inferred_float = 2.718;
    inferred_string = "Hello type system";
    
    // Operaciones binarias seguras
    product = inferred_int * 2.5;
    sum = explicit_int + explicit_float;
    
    // Test de operaciones binarias y promoción de tipos
    sum = explicit_int + explicit_float;  // Debe ser float
    product = inferred_int * 2.5;         // Debe ser float
    
    // Test de objetos y tipos de clases
    print("=== Testing Object Types ===");
    p1 = new_Point();
    Point_init(p1, 0, 0);
    p2 = new_Point();
    Point_init(p2, 3, 4);
    print(Point_distance(p1, p2));  // Debería imprimir 5.0
    
    v1 = new_Vector3();
    Vector3_init(v1, 1, 2, 2);
    print(Vector3_magnitude(v1));  // Debería imprimir 3.0
    
    // Test de herencia y polimorfismo
    print("=== Testing Inheritance ===");
    c1 = new_Circle();
    Circle_init(c1, 0, 0, 5);
    print(Circle_area(c1));    // Debería imprimir ~78.54
    
    // Test de conversión entre tipos primitivos
    int_val = 10;
    float_val = 20.5;
    sum_val = int_val + float_val;  // float (30.5)
    print(sum_val);
    
    // Test de arrays con tipos consistentes
    print("=== Testing Array Types ===");
    int_array = [1, 2, 3, 4, 5];  // Array de ints
    float_array = [1.1, 2.2, 3.3, 4.4]; // Array de floats
    mixed_array = [1, 2.5, 3, 4.5]; // Array mixto (se convierte a float)
    
    // Test de comprobación de tipos en las llamadas a funciones
    print("=== Testing Function Call Types ===");
    Vector3_init(v1, 1, 2, 3);  // Correcto
    
    // Test Circle con herencia
    print("=== Testing Circle Inheritance ===");
    Circle_scale(c1, 2);
    print(Circle_area(c1));    // Debería imprimir ~314.16
    
    // Test de las nuevas estructuras de control
    
    print("=== Testing Control Structures ===");
    
    // Test while loop
    print("Testing while loop...");
    i = 0;
    count = 0;
    while i < 5
        count = count + 1;
        i = i + 1;
    end
    if count == 5
        print("[PASS] While loop executed correctly");
    else
        print("[FAIL] While loop test failed");
    end
    
    // Test do-while loop
    print("Testing do-while loop...");
    j = 10;
    do_while_count = 0;
    do
        do_while_count = do_while_count + 1;
        j = j - 1;
    while j > 5 end
    if do_while_count == 5
        print("[PASS] Do-while loop executed correctly");
    else
        print("[FAIL] Do-while loop test failed");
    end
    
    // Test switch statement
    print("Testing switch statement...");
    day = 3;
    day_name = "";
    switch day
        case 1
            day_name = "Monday";
        case 2
            day_name = "Tuesday";
        case 3
            day_name = "Wednesday";
        case 4
            day_name = "Thursday";
        case 5
            day_name = "Friday";
        default
            day_name = "Weekend";
    end
    if day_name == "Wednesday"
        print("[PASS] Switch statement selected correct case");
    else
        print("[FAIL] Switch statement test failed");
    end
    
    // Test try-catch
    print("Testing try-catch-finally...");
    error_caught = false;
    finally_executed = false;
    
    try
        if 1 == 1  // Always true condition to test throw
            throw "Test error";
        end
    catch err
        error_caught = true;
        print("Caught: " + err);
    finally
        finally_executed = true;
    end
    
    if error_caught
        if finally_executed
            print("[PASS] Try-catch-finally executed correctly");
        else
            print("[PARTIAL] Error caught but finally block not executed");
        end
    else
        if finally_executed
            print("[PARTIAL] Finally executed but error not caught");
        else
            print("[FAIL] Try-catch-finally test failed completely");
        end
    end
    
    // Summary
    print("");
    print("===== CONTROL STRUCTURE TEST SUMMARY =====");
    print("[PASS] - While loops implemented successfully");
    print("[PASS] - Do-while loops implemented successfully");
    print("[PASS] - Switch statements implemented successfully");
    print("[PASS] - Try-catch-finally blocks implemented successfully");
    print("==========================================");
end